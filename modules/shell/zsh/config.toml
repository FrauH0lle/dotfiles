depends = [ "shell/common" ]

# Packages
[[packages]]
install = [ "dotdeploy/shell-zsh" ]
if = "(eq DOD_DISTRIBUTION_NAME 'gentoo')"

# Files
# Package configuration
[[files]]
source = "gentoo/portage/*"
target = "/etc/portage/*"
phase = "setup"
action = "copy"
if = "(eq DOD_DISTRIBUTION_NAME 'gentoo')"

[[files]]
source = "common/home/*"
target = "$HOME/*"

# Actions

## Install and maintain zinit
[[tasks]]
exec = "$DOD_ROOT/scripts/ensure_repo.sh"
args = [ "https://github.com/zdharma-continuum/zinit.git", "~/.config/zsh/.zinit/bin" ]

[[tasks]]
shell = """
"$DOD_ROOT/scripts/ensure_repo.sh" https://github.com/zdharma-continuum/zinit.git ~/.config/zsh/.zinit/bin
cd ~/.config/zsh/.zinit/bin
git pull --rebase
"""
phase = "update"

[[tasks]]
shell = """
rm "$HOME"/.zshenv
rm -rf ~/.config/zsh/
"""
phase = "remove"

## Install and maintain base16 colors
[[tasks]]
shell = """
"$DOD_ROOT/scripts/ensure_repo.sh" https://github.com/chriskempson/base16-shell.git ~/.config/base16-shell
cd ~/.config/base16-shell
git pull --rebase
"""
phase = "update"

[[tasks]]
shell = """
rm -rf ~/.config/base16-shell
"""
phase = "remove"

[[tasks]]
exec = "$DOD_ROOT/scripts/ensure_repo.sh"
args = [ "https://github.com/chriskempson/base16-shell.git", "~/.config/base16-shell" ]

## Ensure .zshenv symlink exists
[[tasks]]
shell = """ln -svf "$HOME"/.zshenv "$HOME"/.config/zsh/.zshenv"""
